function africa(){function t(t){var r,n,a;if(t&&e!==t){var i=d.centroid(t);r=i[0],n=i[1],a=6,e=t}else r=l/2,n=s/3,a=1,e=null;o.selectAll("path").classed("active",e&&function(t){return t===e}),o.selectAll("text").style("fill-opacity",e&&function(t){return t===e}?1:0),o.transition().duration(750).attr("transform","translate("+l/2+","+s/3+")scale("+a+")translate("+-r+","+-n+")").style("stroke-width",1.5/a+"px"),"Liberia"==t.properties.name?d3.select("#nextButton").html(t.properties.name+" -- click here for next step").classed("btn-primary",!0).classed("btn-danger",!1).attr("disabled",null):d3.select("#nextButton").html(t.properties.name+" -- no data (select another)").classed("btn-primary",!1).classed("btn-danger",!0).attr("disabled","disabled")}var e,r=60,n=3,a=330,i=d3.select("div #countries");console.log("Div height & width: "+i.attr("height")+", "+i.attr("width"));var l=$("div #countries").width(),s=$("div #countries").height();s=500,l=450,console.log("Div height & width (jQuery): "+s+", "+l);var o=d3.select("div#countries").append("svg").attr("width",l).attr("height",s).append("g").attr("id","countries");o.append("rect").attr("fill","#aaa").style("fill-opacity",1).attr("width",l).attr("height",s);var c=d3.geo.mercator().center([r,n]).scale(a),d=d3.geo.path().projection(c);d3.json("d3/africa.json",function(e,r){data=r,o.selectAll("path").data(topojson.feature(r,r.objects.subunits).features).enter().append("path").attr("d",d).on("click",t),o.append("path").datum(topojson.mesh(r,r.objects.subunits)).attr("d",d).attr("class","boundary"),o.selectAll("text").data(topojson.feature(r,r.objects.subunits).features).enter().append("text").attr("class","label").attr("id",function(t,e){return"country-label"+e}).text(function(t){return t.properties.name}).attr("transform",function(t){return"translate("+d.centroid(t)+")"})})}function profittree(){function t(n){var a=d3.event&&d3.event.altKey?5e3:500,i=u.nodes(r).reverse();i.forEach(function(t){t.y=280*t.depth});var h=p.selectAll("g.node").data(i,function(t){return t.id||(t.id=++l)}),g=h.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+n.y0+","+n.x0+")"}).on("click",function(r){e(r),t(r)});g.append("svg:circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),g.append("svg:text").attr("x",function(t){return t.children||t._children?-10:10}).attr("y",-d).attr("dy","1em").attr("text-anchor",function(t){return t.children||t._children?"middle":"middle"}).text(function(t){return t.name}).style("fill-opacity",1e-6),g.append("image").attr("class","map").attr("width",o+"px").attr("height",s+"px").attr("x",c+"px").attr("y",d+"px").attr("xlink:href",function(t){return t.image}),g.append("rect").attr("width",o+"px").attr("height",s+"px").attr("x",c+"px").attr("y",d+"px").style("stroke","gray").style("stroke-width","2px").style("fill","none");var y=h.transition().duration(a).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});y.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),y.select("text").style("fill-opacity",1);var x=h.exit().transition().duration(a).attr("transform",function(){return"translate("+n.y+","+n.x+")"}).remove();x.select("circle").attr("r",1e-6),x.select("text").style("fill-opacity",1e-6);var m=p.selectAll("path.link").data(u.links(i),function(t){return t.target.id});m.enter().insert("svg:path","g").attr("class","link").attr("d",function(){var t={x:n.x0,y:n.y0};return f({source:t,target:t})}).transition().duration(a).attr("d",f),m.transition().duration(a).attr("d",f),m.exit().transition().duration(a).attr("d",function(){var t={x:n.x,y:n.y};return f({source:t,target:t})}).remove(),i.forEach(function(t){t.x0=t.x,t.y0=t.y})}function e(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}var r,n=[20,120,20,120],a=800-n[1]-n[3],i=500-n[0]-n[2],l=0,s=120,o=Math.round(1370*s/1075),c=-o/2,d=-s/2,u=d3.layout.tree().size([i,a]),f=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),p=d3.select("#profittree").append("svg").attr("width",a+n[1]+n[3]).attr("height",i+n[0]+n[2]).append("svg:g").attr("transform","translate("+n[3]+","+n[0]+")"),h={name:"Profit optimization",image:"../images/impact_small_maps/ProfitSummation.png",children:[{name:"Labor quality",image:"../images/impact_small_maps/WorkForce.png"},{name:"Market access",image:"../images/impact_small_maps/Market_Access.png"},{name:"Agricultural potential",image:"../images/impact_small_maps/Cropland_value.png"}]};r=h,r.x0=i/2,r.y0=0,t(r)}function marketlandtree(){function t(n){var a=d3.event&&d3.event.altKey?5e3:500,i=u.nodes(r).reverse();i.forEach(function(t){t.y=280*t.depth});var h=p.selectAll("g.node").data(i,function(t){return t.id||(t.id=++l)}),g=h.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+n.y0+","+n.x0+")"}).on("click",function(r){e(r),t(r)});g.append("svg:circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),g.append("svg:text").attr("x",function(t){return t.children||t._children?-10:10}).attr("y",-d).attr("dy","1em").attr("text-anchor",function(t){return t.children||t._children?"middle":"middle"}).text(function(t){return t.name}).style("fill-opacity",1e-6),g.append("image").attr("class","map").attr("width",o+"px").attr("height",s+"px").attr("x",c+"px").attr("y",d+"px").attr("xlink:href",function(t){return t.image}),g.append("rect").attr("width",o+"px").attr("height",s+"px").attr("x",c+"px").attr("y",d+"px").style("stroke","gray").style("stroke-width","2px").style("fill","none");var y=h.transition().duration(a).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});y.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),y.select("text").style("fill-opacity",1);var x=h.exit().transition().duration(a).attr("transform",function(){return"translate("+n.y+","+n.x+")"}).remove();x.select("circle").attr("r",1e-6),x.select("text").style("fill-opacity",1e-6);var m=p.selectAll("path.link").data(u.links(i),function(t){return t.target.id});m.enter().insert("svg:path","g").attr("class","link").attr("d",function(){var t={x:n.x0,y:n.y0};return f({source:t,target:t})}).transition().duration(a).attr("d",f),m.transition().duration(a).attr("d",f),m.exit().transition().duration(a).attr("d",function(){var t={x:n.x,y:n.y};return f({source:t,target:t})}).remove(),i.forEach(function(t){t.x0=t.x,t.y0=t.y})}function e(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}var r,n=[20,120,20,120],a=800-n[1]-n[3],i=500-n[0]-n[2],l=0,s=120,o=Math.round(1370*s/1075),c=-o/2,d=-s/2,u=d3.layout.tree().size([i,a]),f=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),p=d3.select("#marketlandtree").append("svg").attr("width",a+n[1]+n[3]).attr("height",i+n[0]+n[2]).append("svg:g").attr("transform","translate("+n[3]+","+n[0]+")"),h={name:"Land productivity + Market access",image:"../images/impact_small_maps/MarketAccess+CroplandValue.png",children:[{name:"Land productivity",image:"../images/impact_small_maps/Cropland_value.png"},{name:"Market access",image:"../images/impact_small_maps/Market_Access.png"}]};r=h,r.x0=i/2,r.y0=0,t(r)}function conflictinstabilitytree(){function t(n){var a=d3.event&&d3.event.altKey?5e3:500,i=u.nodes(r).reverse();i.forEach(function(t){t.y=280*t.depth});var h=p.selectAll("g.node").data(i,function(t){return t.id||(t.id=++l)}),g=h.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+n.y0+","+n.x0+")"}).on("click",function(r){e(r),t(r)});g.append("svg:circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),g.append("svg:text").attr("x",function(t){return t.children||t._children?-10:10}).attr("y",-d).attr("dy","1em").attr("text-anchor",function(t){return t.children||t._children?"middle":"middle"}).text(function(t){return t.name}).style("fill-opacity",1e-6),g.append("image").attr("class","map").attr("width",o+"px").attr("height",s+"px").attr("x",c+"px").attr("y",d+"px").attr("xlink:href",function(t){return t.image}),g.append("rect").attr("width",o+"px").attr("height",s+"px").attr("x",c+"px").attr("y",d+"px").style("stroke","gray").style("stroke-width","2px").style("fill","none");var y=h.transition().duration(a).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});y.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),y.select("text").style("fill-opacity",1);var x=h.exit().transition().duration(a).attr("transform",function(){return"translate("+n.y+","+n.x+")"}).remove();x.select("circle").attr("r",1e-6),x.select("text").style("fill-opacity",1e-6);var m=p.selectAll("path.link").data(u.links(i),function(t){return t.target.id});m.enter().insert("svg:path","g").attr("class","link").attr("d",function(){var t={x:n.x0,y:n.y0};return f({source:t,target:t})}).transition().duration(a).attr("d",f),m.transition().duration(a).attr("d",f),m.exit().transition().duration(a).attr("d",function(){var t={x:n.x,y:n.y};return f({source:t,target:t})}).remove(),i.forEach(function(t){t.x0=t.x,t.y0=t.y})}function e(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}var r,n=[20,120,20,120],a=800-n[1]-n[3],i=500-n[0]-n[2],l=0,s=120,o=Math.round(1370*s/1075),c=-o/2,d=-s/2,u=d3.layout.tree().size([i,a]),f=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),p=d3.select("#conflictinstabilitytree").append("svg").attr("width",a+n[1]+n[3]).attr("height",i+n[0]+n[2]).append("svg:g").attr("transform","translate("+n[3]+","+n[0]+")"),h={name:"Conflict risk + Instability risk",image:"../images/impact_small_maps/SumConflict+InstabilityRisk.png",children:[{name:"Conflict Risk",image:"../images/impact_small_maps/ConflictRisk.png"},{name:"Instability Risk",image:"../images/impact_small_maps/InstabilityRisk.png"}]};r=h,r.x0=i/2,r.y0=0,t(r)}function risktree(){function t(n){var a=d3.event&&d3.event.altKey?5e3:500,i=u.nodes(r).reverse();i.forEach(function(t){t.y=280*t.depth});var h=p.selectAll("g.node").data(i,function(t){return t.id||(t.id=++l)}),g=h.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+n.y0+","+n.x0+")"}).on("click",function(r){e(r),t(r)});g.append("svg:circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),g.append("svg:text").attr("x",function(t){return t.children||t._children?-10:10}).attr("y",-d).attr("dy","1em").attr("text-anchor",function(t){return t.children||t._children?"middle":"middle"}).text(function(t){return t.name}).style("fill-opacity",1e-6),g.append("image").attr("class","map").attr("width",o+"px").attr("height",s+"px").attr("x",c+"px").attr("y",d+"px").attr("xlink:href",function(t){return t.image}),g.append("rect").attr("width",o+"px").attr("height",s+"px").attr("x",c+"px").attr("y",d+"px").style("stroke","gray").style("stroke-width","2px").style("fill","none");var y=h.transition().duration(a).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});y.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),y.select("text").style("fill-opacity",1);var x=h.exit().transition().duration(a).attr("transform",function(){return"translate("+n.y+","+n.x+")"}).remove();x.select("circle").attr("r",1e-6),x.select("text").style("fill-opacity",1e-6);var m=p.selectAll("path.link").data(u.links(i),function(t){return t.target.id});m.enter().insert("svg:path","g").attr("class","link").attr("d",function(){var t={x:n.x0,y:n.y0};return f({source:t,target:t})}).transition().duration(a).attr("d",f),m.transition().duration(a).attr("d",f),m.exit().transition().duration(a).attr("d",function(){var t={x:n.x,y:n.y};return f({source:t,target:t})}).remove(),i.forEach(function(t){t.x0=t.x,t.y0=t.y})}function e(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}var r,n=[20,120,20,120],a=800-n[1]-n[3],i=500-n[0]-n[2],l=0,s=120,o=Math.round(1370*s/1075),c=-o/2,d=-s/2,u=d3.layout.tree().size([i,a]),f=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),p=d3.select("#risktree").append("svg:svg").attr("width",a+n[1]+n[3]).attr("height",i+n[0]+n[2]).append("svg:g").attr("transform","translate("+n[3]+","+n[0]+")"),h={name:"Risk Mitigation",image:"/images/impact_small_maps/RiskSummation.png",children:[{name:"Conflict vulnerability",image:"/images/impact_small_maps/ConflictRisk.png"},{name:"Instability",image:"/images/impact_small_maps/InstabilityRisk.png"},{name:"Environmental change",image:"/images/impact_small_maps/EnvironmentalRisk.png"}]};r=h,r.x0=i/2,r.y0=0,t(r)}function compiletree(){function t(n){var a=d3.event&&d3.event.altKey?5e3:500,i=d.nodes(r).reverse();i.forEach(function(t){t.y=400*t.depth});var p=f.selectAll("g.node").data(i,function(t){return t.id||(t.id=++l)}),h=p.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+n.y0+","+n.x0+")"}).on("click",function(r){e(r),t(r)});h.append("svg:circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),h.append("svg:text").attr("x",function(t){return t.children||t._children?-10:10}).attr("y",-c).attr("dy","1em").attr("text-anchor",function(t){return t.children||t._children?"middle":"middle"}).text(function(t){return t.name}).style("fill-opacity",1e-6),h.append("image").attr("class","map").attr("width",imgWidth+"px").attr("height",s+"px").attr("x",o+"px").attr("y",c+"px").attr("xlink:href",function(t){return t.image}),h.append("rect").attr("width",imgWidth+"px").attr("height",s+"px").attr("x",o+"px").attr("y",c+"px").style("stroke","gray").style("stroke-width","2px").style("fill","none");var g=p.transition().duration(a).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});g.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),g.select("text").style("fill-opacity",1);var y=p.exit().transition().duration(a).attr("transform",function(){return"translate("+n.y+","+n.x+")"}).remove();y.select("circle").attr("r",1e-6),y.select("text").style("fill-opacity",1e-6);var x=f.selectAll("path.link").data(d.links(i),function(t){return t.target.id});x.enter().insert("svg:path","g").attr("class","link").attr("d",function(){var t={x:n.x0,y:n.y0};return u({source:t,target:t})}).transition().duration(a).attr("d",u),x.transition().duration(a).attr("d",u),x.exit().transition().duration(a).attr("d",function(){var t={x:n.x,y:n.y};return u({source:t,target:t})}).remove(),i.forEach(function(t){t.x0=t.x,t.y0=t.y})}function e(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}var r,n=[20,120,20,120],a=800-n[1]-n[3],i=600-n[0]-n[2],l=0,s=imgWidth=250,o=-s/3,c=-s/2,d=d3.layout.tree().size([i,a]),u=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),f=d3.select("#compiletree").append("svg").attr("width",a+n[1]+n[3]).attr("height",i+n[0]+n[2]).append("svg:g").attr("transform","translate("+n[3]+","+n[0]+")"),p={name:"Profit + Risk",image:"../images/impact_maps/CombinedProfitSum+RiskSum.png",children:[{name:"Profit optimization",image:"../images/impact_small_maps/ProfitSummation.png"},{name:"Risk mitigation",image:"../images/impact_small_maps/RiskSummation.png"}]};r=p,r.x0=i/2,r.y0=0,t(r)}function alltree(){function t(n){var a=d3.event&&d3.event.altKey?5e3:500,i=u.nodes(r).reverse();i.forEach(function(t){t.y=120*t.depth});var h=p.selectAll("g.node").data(i,function(t){return t.id||(t.id=++l)}),g=h.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+n.y0+","+n.x0+")"}).on("click",function(r){e(r),t(r)});g.append("svg:circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),g.append("svg:text").attr("x",function(t){return t.children||t._children?-10:10}).attr("y",function(t){return t.image?-d:"-0.8em"}).attr("dy","1em").attr("text-anchor",function(t){return t.children||t._children?"middle":"start"}).text(function(t){return t.name}).style("fill-opacity",1e-6),g.append("image").attr("class","map").attr("width",o+"px").attr("height",s+"px").attr("x",c+"px").attr("y",d+"px").attr("xlink:href",function(t){return t.image?"/images/impact_small_maps/"+t.image:null}),g.append("rect").attr("width",o+"px").attr("height",s+"px").attr("x",c+"px").attr("y",d+"px").style("stroke",function(t){return t.image?"gray":"none"}).style("stroke-width","1px").style("fill","none");var y=h.transition().duration(a).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});y.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),y.select("text").style("fill-opacity",1);var x=h.exit().transition().duration(a).attr("transform",function(){return"translate("+n.y+","+n.x+")"}).remove();x.select("circle").attr("r",1e-6),x.select("text").style("fill-opacity",1e-6);var m=p.selectAll("path.link").data(u.links(i),function(t){return t.target.id});m.enter().insert("svg:path","g").attr("class","link").attr("d",function(){var t={x:n.x0,y:n.y0};return f({source:t,target:t})}).transition().duration(a).attr("d",f),m.transition().duration(a).attr("d",f),m.exit().transition().duration(a).attr("d",function(){var t={x:n.x,y:n.y};return f({source:t,target:t})}).remove(),i.forEach(function(t){t.x0=t.x,t.y0=t.y})}function e(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}var r,n=[20,120,20,120],a=800-n[1]-n[3],i=500-n[0]-n[2],l=0,s=50,o=Math.round(1370*s/1075),c=-o/2,d=-s/2,u=d3.layout.tree().size([i,a]),f=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),p=d3.select("#alltree").append("svg:svg").attr("width",a+n[1]+n[3]).attr("height",i+n[0]+n[2]).append("svg:g").attr("transform","translate("+n[3]+","+n[0]+")");d3.json("/data/alltree.json",function(e){r=e,r.x0=i/2,r.y0=0,t(r)})}function thirdtree(t,e){function r(t){var e=d3.event&&d3.event.altKey?5e3:500,i=p.nodes(a).reverse();i.forEach(function(t){t.y=180*t.depth});var l=g.selectAll("g.node").data(i,function(t){return t.id||(t.id=++o)}),s=l.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+t.y0+","+t.x0+")"}).on("click",function(t){n(t),r(t)});s.append("svg:circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),s.append("svg:text").attr("x",function(t){return t.image?u+imgWidth/2:t.children||t._children?-10:10}).attr("y",function(t){return t.image?-f:t.children||t._children?"1em":"-0.8em"}).attr("dy","1em").attr("text-anchor",function(t){return t.image?"middle":t.children||t._children?"middle":"start"}).text(function(t){return t.name}).style("fill-opacity",1e-6),s.append("image").attr("class","map").attr("width",imgWidth+"px").attr("height",c+"px").attr("x",u+"px").attr("y",f+"px").attr("xlink:href",function(t){return t.image?"/images/impact_small_maps/"+t.image:null}),s.append("rect").attr("width",imgWidth+"px").attr("height",c+"px").attr("x",u+"px").attr("y",f+"px").style("stroke",function(t){return t.image?"gray":"none"}).style("stroke-width","1px").style("fill","none");var d=l.transition().duration(e).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});d.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),d.select("text").style("fill-opacity",1);var y=l.exit().transition().duration(e).attr("transform",function(){return"translate("+t.y+","+t.x+")"}).remove();y.select("circle").attr("r",1e-6),y.select("text").style("fill-opacity",1e-6);var x=g.selectAll("path.link").data(p.links(i),function(t){return t.target.id});x.enter().insert("svg:path","g").attr("class","link").attr("d",function(){var e={x:t.x0,y:t.y0};return h({source:e,target:e})}).transition().duration(e).attr("d",h),x.transition().duration(e).attr("d",h),x.exit().transition().duration(e).attr("d",function(){var e={x:t.x,y:t.y};return h({source:e,target:e})}).remove(),i.forEach(function(t){t.x0=t.x,t.y0=t.y})}function n(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}var a,i=[20,120,20,220],l=800-i[1]-i[3],s=400-i[0]-i[2],o=0,c=imgWidth=250,d=50,u=-imgWidth+d,f=-c/2,p=d3.layout.tree().size([s,l]),h=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),g=d3.select("#thirdtree").append("svg:svg").attr("width",l+i[1]+i[3]).attr("height",s+i[0]+i[2]).append("svg:g").attr("transform","translate("+i[3]+","+i[0]+")");d3.json("data/alltree.json",function(n){console.log(JSON.stringify(n,null,3)),a=n.children[t].children[e],a.x0=s/2,a.y0=0,r(a)})}function drawEmmatrix(){var t=["YlOrBr","YlGn","Oranges","Blues","Purples","Reds","Greens","BuPu"],e={top:80,right:100,bottom:10,left:10},r=600,n=600,a=d3.scale.ordinal().rangeBands([0,r]),i=(d3.scale.linear().domain([0,4]).clamp(!0),d3.scale.ordinal().domain(d3.range(8)).range(d3.range(8))),l=d3.select("#myGraphic").append("svg").attr("width",r+e.left+e.right).attr("height",n+e.top+e.bottom),s=l.append("g").attr("transform","translate("+e.left+","+e.top+")");d3.tsv("/data/mdg-progress5.tsv",function(o,c){d3.tsv("/data/non-mdg.tsv",function(o,d){function u(t){d3.select(this).selectAll(".cell").data(t).enter().append("rect").attr("class","cell").attr("x",function(t){return a(t.x)}).attr("width",a.rangeBand()).attr("height",a.rangeBand()).style("fill",function(t){return goals[t.x]==goals[t.y]||t.x>=y||t.y>=y?null:"#CCC"}).style("fill-opacity",function(t){return goals[t.x]==goals[t.y]||t.x>=y||t.y>=y?null:1-t.z/7}).attr("class",function(t){return" g"+goals[t.x]+"-z"+t.z+" cell"})}function f(t){a.domain(x[t]);var r=m.transition().duration(2500),n=s.transition().duration(2500);n.selectAll(".row").delay(function(t,e){return 4*a(e)}).attr("transform",function(t,e){return"translate(0,"+a(e)+")"}).selectAll(".cell").delay(function(t){return 4*a(t.x)}).attr("x",function(t){return a(t.x)}),r.selectAll(".column").delay(function(t,e){return 4*a(e)}).attr("transform",function(t,r){return"translate("+a(r)+","+e.top+" )rotate(-45)"}),n.selectAll(".column").delay(function(t,e){return 4*a(e)}).attr("transform",function(t,e){return"translate("+a(e)+")rotate(-90)"})}goals=[],ranks=[],indicators=[],numbers=[],c=c.map(function(t){var e={goal:+t.Goal-1,number:+t["Indicator #"],name:t.Abbrev,rank:t["Relative Ranking:"]?+t["Relative Ranking:"]:-1};return goals.push(e.goal),ranks.push(e.rank),indicators.push(e.name),numbers.push(e.number),e}),d=[];var p=c.length,h=d.length;d.forEach(function(t){var e={goal:t.MDG-1,name:t.Abbrev,rank:-1};goals.push(e.goal),ranks.push(e.rank),indicators.push(e.name),c.push(e)});var g=[];p=32,h=26,c.forEach(function(t,e){g.push(d3.range(p+h).map(function(r){var n=null;return n=p>e&&p>r?Math.min(+t.rank,+c[r].rank):e>=p&&r>=p?0:0,{x:r,y:e,z:n,goal:c[r].goal}}))});var y=p;p=g.length;var x=(d3.range(p).map(function(){return Math.random()}),{index:d3.range(p),goal:d3.range(p).sort(function(t,e){return d3.ascending(goals[t],goals[e])}),rank:d3.range(p).sort(function(t,e){return d3.descending(ranks[t],ranks[e])}),numbers:d3.range(p).sort(function(t,e){return d3.ascending(numbers[t],numbers[e])})});s.append("rect").attr("class","background").attr("width",r).attr("height",n),a.domain(x.rank);var m=l.append("g").attr("transform","translate("+e.left+")");m.selectAll(".column").data(indicators).enter().append("text").attr("class","column").attr("width",a.rangeBand()).attr("height",a.rangeBand()).attr("dx","1em").attr("text-anchor","start").text(function(t,e){return indicators[e]}).attr("transform",function(t,r){return"translate("+a(r)+","+e.top+" )rotate(-45)"});var u=s.selectAll(".row").data(g).enter().append("g").attr("class",function(e,r){return"row "+t[e[r].goal]}).attr("transform",function(t,e){return"translate(0,"+a(e)+")"}).each(u);u.append("text").attr("x",r+6).attr("y",a.rangeBand()/2).attr("dy",".32em").attr("text-anchor","start").style("fill",function(t,e){return i(goals[e])}).text(function(t,e){return indicators[e]}),d3.select("#order").on("change",function(){f(this.value)})})})}function scatter(t,e,r){function n(t){return+t.properties[e[0]]}function a(t){return+t.properties[e[1]]}function i(t){return+t.properties.fatalities}var l=650,s=200,o={top:20,right:70,bottom:10,left:80},c=l-o.left-o.right,d=s-o.top-o.bottom,u=d3.time.scale().domain(d3.extent(t.map(n))).range([0,c]),f=d3.time.scale().domain(d3.extent(t.map(n))).range([0,maxDuration]);tDelay=f,dateRange=d3.extent(t.map(n));var p=(d3.scale.linear().domain(d3.extent(t.map(i))).range([0,100]),d3.scale.linear().domain(d3.extent(t.map(a))).range([d,0])),h=d3.svg.axis().scale(u).orient("bottom"),g=d3.svg.axis().scale(p).ticks(4).orient("left");r.attr("width",l).attr("height",s);var y=r.append("g").attr("transform","translate("+o.left+","+o.top+")");y.append("g").attr("class","y axis").call(g),y.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")").call(h),y.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",-d/2).attr("y",-6-o.left/3).attr("dy","-.75em").attr("transform","rotate(-90)").text("Latitude (degrees)"),y.selectAll("circle.scatter-circle").data(t).enter().append("circle").attr("class","scatter-circle").transition().delay(function(t){return f(n(t))}).style("fill",function(t){return t.properties.BokoHaram?"red":"#a0a0a0"}).attr("cx",function(t){return u(n(t))}).attr("cy",function(t){return p(a(t))}).attr("r",5),brush=d3.svg.brush().x(u).on("brush",brushed),y.append("g").attr("class","x brush").call(brush).selectAll("rect").attr("y",-6).attr("height",d+7),startBrush()}function brushed(){function t(t){return t.properties.date>extent[0]&&t.properties.date<extent[1]?1:0}extent=brush.extent(),extent[1].toDateString()==extent[0].toDateString()&&extent[1].setFullYear(extent[0].getFullYear()+1),brush.extent(extent),d3.select(".x.brush").call(brush),myDots=d3.selectAll("path.myDot").style("fill-opacity",t)}function startBrush(){console.log("brush: I've been (re)started");var t=new Date(dateRange[0]),e=new Date(dateRange[0]).setFullYear(t.getFullYear()+1),r=new Date(dateRange[1]),n=new Date(dateRange[1]).setFullYear(r.getFullYear()-1),a=(e-t)/(r-t);d3.select(".x.brush").call(brush.extent([t,t])).transition().ease("linear").duration(a*maxDuration).call(brush.extent([t,e])).transition().ease("linear").duration((1-a)*maxDuration).call(brush.extent([n,r]))}function myTreemap(){function t(){this.style("left",function(t){return t.x+"px"}).style("top",function(t){return t.y+"px"}).style("width",function(t){return Math.max(0,t.dx-1)+"px"}).style("height",function(t){return Math.max(0,t.dy-1)+"px"})}var e={top:0,right:0,bottom:0,left:0},r=800-e.left-e.right,n=400-e.top-e.bottom,a=d3.scale.category20c(),i=d3.select("#myTreemap").style("position","relative").style("width",r+e.left+e.right+"px").style("height",n+e.top+e.bottom+"px").style("left",e.left+"px").style("top",e.top+"px"),l=d3.layout.treemap().size([r,n]).value(function(t){return t["Amount (USDx1000)"]});d3.tsv("/data/liberia-exports.tsv",function(e,r){{var n={name:"Liberia",children:r};i.datum(n).selectAll(".node").data(l.nodes).enter().append("div").attr("class","node").call(t).style("background",function(t,e){return a(e)}).text(function(t){return t.children?null:t.Product})}})}function myCollapsableTree(){function t(n){var a=d3.event&&d3.event.altKey?5e3:500,i=s.nodes(r).reverse();i.forEach(function(t){t.y=180*t.depth});var d=c.selectAll("g.node").data(i,function(t){return t.id||(t.id=++l)}),u=d.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+n.y0+","+n.x0+")"}).on("click",function(r){e(r),t(r)});u.append("svg:circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),u.append("svg:text").attr("x",function(t){return t.children||t._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name}).style("fill-opacity",1e-6);var f=d.transition().duration(a).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});f.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),f.select("text").style("fill-opacity",1);var p=d.exit().transition().duration(a).attr("transform",function(){return"translate("+n.y+","+n.x+")"}).remove();p.select("circle").attr("r",1e-6),p.select("text").style("fill-opacity",1e-6);var h=c.selectAll("path.link").data(s.links(i),function(t){return t.target.id});h.enter().insert("svg:path","g").attr("class","link").attr("d",function(){var t={x:n.x0,y:n.y0};return o({source:t,target:t})}).transition().duration(a).attr("d",o),h.transition().duration(a).attr("d",o),h.exit().transition().duration(a).attr("d",function(){var t={x:n.x,y:n.y};return o({source:t,target:t})}).remove(),i.forEach(function(t){t.x0=t.x,t.y0=t.y})}function e(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}var r,n=[20,50,20,180],a=1050-n[1]-n[3],i=800-n[0]-n[2],l=0,s=d3.layout.tree().size([i,a]),o=d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),c=d3.select("#myCollapsableTree").append("svg:svg").attr("width",a+n[1]+n[3]).attr("height",i+n[0]+n[2]).append("svg:g").attr("transform","translate("+n[3]+","+n[0]+")");d3.json("data/tree.json",function(e){r=e,r.x0=i/2,r.y0=0,t(r)})}function button(t){function e(){clearButton(),restart(),d3.timer(function(){return resetButton(),!0},1.1*maxDuration)}var r=.5,n=220*r,a=80*r,i=10*r,l=10*r,s=120*r,o=66*r;text="Retart",toggle=!1;t.append("rect").attr("id","restartButton").attr("width",n+"px").attr("height",a+"px").style("fill",buttonColor).style("fill-opacity",1).attr("x",i).attr("y",l).attr("ry",a/10);t.append("text").attr("id","buttonText").attr("x",s).attr("y",o).style("text-align","center").style("text-anchor","middle").style("fill","#fff").style("stroke","none").style("font-family","Helvetica, sans-serif").style("font-size",a/2+"px").text(text),t.append("rect").attr("width",n+"px").attr("height",a+"px").style("opacity",0).style("pointer-events","all").attr("x",i).attr("y",l).attr("ry",a/2).on("click",e),clearButton(),console.log("Button BBox: "+d3.select("#buttonText")[0][0].getBBox().x+", "+d3.select("#buttonText")[0][0].getBBox().y)}function clearButton(){d3.select("#buttonText").text(""),d3.select("#restartButton").style("fill","#fff")}function resetButton(){d3.select("#restartButton").transition().ease("linear").duration(2e3).style("fill",buttonColor),d3.select("#buttonText").text("Restart").style("fill","#fff").transition().ease("linear").duration(2e3).style("fill","#fff")}!function(){var t=["YlOrBr","YlGn","Oranges","Blues","Purples","Reds","Greens","BuPu"],e={top:10,right:600,bottom:10,left:0},r=500,n=500;nShades=8,dy=n/(t.length*nShades);var a=d3.scale.ordinal().rangeBands([0,r]),i=d3.scale.linear().domain([-100,100]).rangeRound([0,7]).clamp(!0),l=(d3.scale.ordinal().domain(d3.range(8)).range(d3.range(8)),d3.select("#breedtrix").append("svg").attr("width",r+e.left+e.right).attr("height",n+e.top+e.bottom)),s=l.append("g").attr("transform","translate("+e.left+","+e.top+")"),o=d3.select("body").append("div").attr("class","tooltip").style("background-color","lightblue").style("padding","0.3em").style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif').style("font-size","1em").style("border","1px solid black").style("position","absolute").style("visibility","hidden");d3.csv("/data/breedtrix.csv",function(c,d){function u(t,e){var r=d3.select(this).selectAll(".cell").data(t).enter().append("rect").attr("class","cell").attr("x",function(t){return a(t.x)}).attr("width",a.rangeBand()).attr("height",a.rangeBand()).style("shape-rendering","crispEdges").style("fill",function(t){return v[t.x]==v[t.y]?null:"#999"}).style("fill-opacity",function(t){return v[t.x]==v[t.y]?null:1-t.z/7}).attr("class",function(t){return v[t.x]==v[t.y]?"q"+t.z+"-8 cell":"gray"+t.z+" cell"
});r.on("mouseover",function(t,r){v[r]==v[e]&&o.html(b[t.bucket]).style("visibility","visible")}).on("mousemove",function(){o.style("top",event.pageY-10+"px").style("left",event.pageX+10+"px")}).on("mouseout",function(){o.style("visibility","hidden")})}function f(t){a.domain(B[t]);var e=s.transition().duration(2500);e.selectAll(".row").delay(function(t,e){return 4*a(e)}).attr("transform",function(t,e){return"translate(0,"+a(e)+")"}).selectAll(".cell").delay(function(t){return 4*a(t.x)}).attr("x",function(t){return a(t.x)})}var p,h=n/d.length,g=h/dy,y=e.top,x=0,m=d.length,v=d.map(function(t){return t["Indicator Bucket"]}),b=d3.set(v).values(),k=d.map(function(t){return t["Indicator Abbreviation"]}),_=d3.nest().key(function(t){return t["Indicator Bucket"]}).rollup(function(t){return{length:t.length}}).entries(d);_.forEach(function(t){y+=x*nShades,x=dy*g*t.values.length/nShades,p=x*nShades/2,t.values.y0=y,t.values.dyi=x,t.values.ylabel=p}),l.selectAll(".palette").data(t).enter().append("g").attr("class",function(t){return"palette "+t}).attr("transform",function(t,e){return"translate("+(r+70)+", "+_[e].values.y0+")"}).selectAll(".swatch").data(d3.range(nShades)).enter().append("rect").attr("x",0).attr("y",function(e,r){return r*_[t.indexOf(this.parentNode.classList[1])].values.dyi}).attr("width",dy).attr("height",function(){return _[t.indexOf(this.parentNode.classList[1])].values.dyi}).attr("class",function(t,e){return"swatch q"+e+"-"+nShades}),l.selectAll(".palette").append("text").attr("x",dy+10).attr("y",function(t,e){return _[e].values.ylabel}).attr("dy","0.5em").text(function(t,e){return b[e]}),v=[],ranks=[],matrix=[];var w="Sign-Adjusted Average Change";values=d.map(function(t){return+t[w]}),d.forEach(function(t,e){v[e]=b.indexOf(t["Indicator Bucket"]),ranks[e]=i(values[e]),matrix[e]=d3.range(m).map(function(t){return{x:t,y:e,z:Math.min(i(values[e]),i(values[t])),bucket:v[e]}})});var A=d3.range(m).map(function(){return Math.random()}),B={random:d3.range(m).sort(function(t,e){return d3.ascending(A[t],A[e])}),bucket:d3.range(m).sort(function(t,e){return d3.ascending(v[t],v[e])}),rank:d3.range(m).sort(function(t,e){return d3.descending(ranks[t],ranks[e])})};s.append("rect").attr("class","background").attr("fill","#000").attr("width",r).attr("height",n),a.domain(B.random);var D=s.selectAll(".row").data(matrix).enter().append("g").attr("class",function(e,r){return"row "+t[e[r].bucket]}).attr("transform",function(t,e){return"translate(0,"+a(e)+")"}).each(u);D.append("text").attr("x",r+6).attr("y",a.rangeBand()/2).attr("dy",".32em").attr("text-anchor","start").style("font-size",5).text(function(t,e){return k[e]}),d3.select("#order").on("change",function(){f(this.value)})})}();var brush,dateRange,buttonColor="#428bca";!function(){function t(t){return+t.properties.date}function e(){return 5}function r(){function e(t){console.log("changeYear: "+t),d3.select("#buttonText").text(t).style("fill","#000")}d3.selectAll("path.myDots").style("fill-opacity",0).transition().delay(function(e){return M(t(e))}).style("fill-opacity",1).transition().duration(y).style("fill-opacity",function(t){return t.properties.date.getFullYear()>=2011?1:0}),d3.selectAll("circle.scatter-circle").style("fill-opacity",0).transition().delay(function(e){return M(t(e))}).style("fill-opacity",1),o();var r=2006,n=2012;for(i=r;n>=i;i++)setTimeout(e,M(new Date(i,0,0)),[i]);d3.timer(function(){return console.log("it works"),c(),!0},g),l()}function n(t){function e(t){return+t.properties.date}function r(t){return+t.properties.latitude}function n(t){return+t.properties.fatalities}var i=650,l=200,s={top:40,right:70,bottom:10,left:80},o=i-s.left-s.right,c=l-s.top-s.bottom,u=p,f=d3.time.scale().domain(M.domain()).range([0,o]),h=(d3.time.scale().domain(d3.extent(t.map(e))).range([0,g]),d3.scale.linear().domain(d3.extent(t.map(n))).range([0,100]),d3.scale.linear().domain([3.5,13]).range([c,0])),y=d3.svg.axis().scale(f).ticks(d3.time.years).tickSize(6,0).orient("bottom"),x=d3.svg.axis().scale(h).ticks(4).tickSize(6,0).orient("left");u.attr("width",i).attr("height",l);var m=u.append("g").attr("transform","translate("+s.left+","+s.top+")");m.append("g").attr("class","y axis").call(x),m.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(y).selectAll(".tick text").style("text-anchor","start").attr("x",6).attr("y",8),m.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",o/2).attr("y",0).attr("dy","-.75em").text("Conflicts (with at least 4 fatalities) -- Boko Haram in red"),m.append("text").attr("class","y label").attr("text-anchor","middle").attr("x",-c/2).attr("y",-6-s.left/3).attr("dy","-.75em").attr("transform","rotate(-90)").text("Latitude (\xb0N)"),m.selectAll("circle.scatter-circle").data(t).enter().append("circle").attr("class","scatter-circle").style("fill",function(t){return t.properties.BokoHaram?"red":"#333333"}).style("fill-opacity",0).attr("cx",function(t){return f(e(t))}).attr("cy",function(t){return h(r(t))}).attr("r",5),d=d3.svg.brush().x(f).on("brush",a),m.append("g").attr("class","x brush").call(d).selectAll("rect").attr("y",-6).attr("height",c+7)}function a(){function t(t){return t.properties.date>extent[0]&&t.properties.date<extent[1]?1:0}extent=d.extent(),extent[1].toDateString()==extent[0].toDateString()&&extent[1].setFullYear(extent[0].getFullYear()+1),d.extent(extent),d3.select(".x.brush").call(d),myDots=d3.selectAll("path.myDots").style("fill-opacity",t)}function l(){var t=M.domain(),e=new Date(t[0]),r=new Date(t[0]).setFullYear(e.getFullYear()+1),n=new Date(t[1]),a=new Date(t[1]).setFullYear(n.getFullYear()-1),i=(r-e)/(n-e);d3.select(".x.brush").call(d.extent([e,e])).transition().ease("linear").duration(i*g).call(d.extent([e,r])).transition().ease("linear").duration((1-i)*g).call(d.extent([a,n]))}function s(){{var t=.5,e=220*t,n=80*t,a=10*t,i=10*t,l=120*t,s=66*t,o=u.append("g").attr("transform","translate( 100,"+.65*B+")");o.append("rect").attr("id","restartButton").attr("width",e+"px").attr("height",n+"px").style("fill",x).attr("x",a).attr("y",i).attr("ry",n/10)}o.append("text").attr("id","buttonText").attr("x",l).attr("y",s).style("text-align","center").style("text-anchor","middle").style("fill","#fff").style("stroke","none").style("font-family","sans-serif").style("font-size",n/2+"px").text("Start"),o.append("rect").attr("width",e+"px").attr("height",n+"px").style("opacity",0).style("pointer-events","all").attr("x",a).attr("y",i).attr("ry",n/2).on("click",r)}function o(){d3.select("#buttonText").text(""),d3.select("#restartButton").style("fill","#ffffff")}function c(){d3.select("#restartButton").transition().ease("linear").duration(1e3).style("fill",x),d3.select("#buttonText").text("Restart").transition().ease("linear").duration(1e3).style("fill","#fff")}{var d,u,f,p,h,g=12e3,y=g/6,x="#428bca",m=650,v=450,b=4,k={top:2*b,right:0,bottom:0,left:275},_=675,w=440,A=250,B=200,D=1025,R=1538,j=1072,z=642,E=711,S=d3.geo.equirectangular().scale(j).translate([z,E]).precision(.1),C=d3.geo.path().projection(S),M=d3.time.scale().range([0,g]);d3.scale.linear().range([0,100])}u=d3.select("div#dynamic_plot").append("svg").attr("width",m).attr("height",v).append("g"),d3.json("/data/features.json",function(t,r){h=r.map(function(t){return t.properties.date=new Date(t.properties.date),t}),M=M.domain([new Date(2005,10,0),new Date(2012,3,0)]),u.append("rect").style("fill","white").style("stroke","#888888").style("stroke-width",b).attr("x",b/2).attr("y",b/2).attr("width",m-b).attr("height",v-b),f=u.append("g").attr("transform","translate("+(-_+k.left)+", "+(-w+k.top)+")");f.append("svg:defs").append("svg:clipPath").attr("id","rectClip").append("svg:rect").attr("id","rect1").attr("x",_).attr("y",w).attr("width",A).attr("height",B),f.append("image").attr("xlink:href","/data/Base.png").attr("x",0).attr("y",0).attr("width",R+"px").attr("height",D+"px").style("clip-path","url(#rectClip)");u.append("text").attr("id","yearLabel").style("font-size","20px").style("font-weight",300).style("fill","#777777").attr("x",127.5).attr("y",.75*B),u.append("rect").style("fill","none").style("stroke","#888888").style("stroke-width",1).attr("x",k.left).attr("y",k.top).attr("width",A).attr("height",B),s(),p=u.append("g").attr("id","scatter-svg").attr("transform","translate( 20, "+B+")"),n(h),myDots=f.selectAll("path.myDots").data(h).enter().append("path").attr("class","myDots").style("stroke","none").style("fill",function(t){return t.properties.BokoHaram?"red":"#333333"}).style("fill-opacity",0).attr("d",C.pointRadius(e))})}();